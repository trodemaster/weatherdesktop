2025/11/06 16:00:25 ===========================================
2025/11/06 16:00:25 Wallpaper Test Program
2025/11/06 16:00:25 ===========================================
2025/11/06 16:00:25 Image path: /Users/blake/code/weatherdesktop/rendered/hud-251102-2153.jpg
2025/11/06 16:00:25 Go version: go1.25.3
2025/11/06 16:00:25 OS: darwin
2025/11/06 16:00:25 Arch: arm64
2025/11/06 16:00:25 Goroutines: 1
2025/11/06 16:00:25 File verified:
2025/11/06 16:00:25   Size: 1833117 bytes
2025/11/06 16:00:25   Mode: -rw-r--r--
2025/11/06 16:00:25   ModTime: 2025-11-02 21:53:01.055013722 -0800 PST
2025/11/06 16:00:25 Absolute path: /Users/blake/code/weatherdesktop/rendered/hud-251102-2153.jpg
2025/11/06 16:00:25 ===========================================
2025/11/06 16:00:25 Using original image path (not copying to cache)
2025/11/06 16:00:25 Path: /Users/blake/code/weatherdesktop/rendered/hud-251102-2153.jpg
2025/11/06 16:00:25 Current goroutine: 1
2025/11/06 16:00:25 Calling CGO function...
2025/11/06 16:00:25 Thread check (from Objective-C):
2025/11/06 16:00:25   Is main thread: 1
2025/11/06 16:00:25   Thread name: Main Thread
2025/11/06 16:00:25 Invoking setWallpaperEnhanced...
2025/11/06 16:00:25 Using path: /Users/blake/code/weatherdesktop/rendered/hud-251102-2153.jpg
2025-11-06 16:00:25.679 test_wallpaper[66097:6741584] ===========================================
2025-11-06 16:00:25.679 test_wallpaper[66097:6741584] Wallpaper Test: Starting
2025-11-06 16:00:25.679 test_wallpaper[66097:6741584] Thread: Main Thread (Main: YES)
2025-11-06 16:00:25.679 test_wallpaper[66097:6741584] ===========================================
2025-11-06 16:00:25.679 test_wallpaper[66097:6741584] Setting wallpaper from path: /Users/blake/code/weatherdesktop/rendered/hud-251102-2153.jpg
2025-11-06 16:00:25.679 test_wallpaper[66097:6741584] Created NSURL: file:///Users/blake/code/weatherdesktop/rendered/hud-251102-2153.jpg
2025-11-06 16:00:25.683 test_wallpaper[66097:6741584] File exists:
2025-11-06 16:00:25.683 test_wallpaper[66097:6741584]   Size: 1833117 bytes
2025-11-06 16:00:25.683 test_wallpaper[66097:6741584]   Permissions: 644
2025-11-06 16:00:25.684 test_wallpaper[66097:6741584]   Readable: YES
2025-11-06 16:00:25.691 test_wallpaper[66097:6741584] Image loaded successfully:
2025-11-06 16:00:25.691 test_wallpaper[66097:6741584]   Size: 3840 x 2160 points
2025-11-06 16:00:25.691 test_wallpaper[66097:6741584]   Valid: YES
2025-11-06 16:00:25.782 test_wallpaper[66097:6741584] Found 3 screen(s)
2025-11-06 16:00:25.782 test_wallpaper[66097:6741584] -------------------------------------------
2025-11-06 16:00:25.782 test_wallpaper[66097:6741584] Screen 0:
2025-11-06 16:00:25.782 test_wallpaper[66097:6741584]   Frame: 3840 x 2160 @ 0, 0
2025-11-06 16:00:25.782 test_wallpaper[66097:6741584]   Visible: YES
2025-11-06 16:00:25.782 test_wallpaper[66097:6741584]   Display ID: 2
2025-11-06 16:00:25.782 test_wallpaper[66097:6741584]   Display UUID: (skipping - will match by screen properties)
2025-11-06 16:00:25.785 test_wallpaper[66097:6741584]   Current wallpaper: /Users/blake/Library/Containers/com.apple.wallpaper.agent/Data/Library/Caches/com.apple.wallpaper.caches/extension-com.apple.wallpaper.extension.image/hud-251102-2153.jpg.jpg
2025-11-06 16:00:25.788 test_wallpaper[66097:6741584]   Current options: {
    NSWorkspaceDesktopImageAllowClippingKey = 1;
    NSWorkspaceDesktopImageFillColorKey = "NSCalibratedRGBColorSpace 0.254902 0.411765 0.666667 1";
    NSWorkspaceDesktopImageScalingKey = 3;
}
2025-11-06 16:00:25.789 test_wallpaper[66097:6741584]   Using options: {
    NSWorkspaceDesktopImageAllowClippingKey = 1;
    NSWorkspaceDesktopImageFillColorKey = "NSCalibratedRGBColorSpace 0.254902 0.411765 0.666667 1";
    NSWorkspaceDesktopImageScalingKey = 3;
}
2025-11-06 16:00:25.792 test_wallpaper[66097:6741584]   ✓ API call SUCCESS (took 0.003 seconds)
2025-11-06 16:00:28.004 test_wallpaper[66097:6741584]   ⚠ Verification FAILED:
2025-11-06 16:00:28.004 test_wallpaper[66097:6741584]     Expected: /Users/blake/code/weatherdesktop/rendered/hud-251102-2153.jpg
2025-11-06 16:00:28.004 test_wallpaper[66097:6741584]     Actual:   /System/Library/CoreServices/DefaultDesktop.heic
2025-11-06 16:00:28.004 test_wallpaper[66097:6741584]     This indicates macOS extension system issue
2025-11-06 16:00:28.005 test_wallpaper[66097:6741584] -------------------------------------------
2025-11-06 16:00:28.005 test_wallpaper[66097:6741584] Screen 1:
2025-11-06 16:00:28.005 test_wallpaper[66097:6741584]   Frame: 3840 x 2160 @ -7680, -7
2025-11-06 16:00:28.006 test_wallpaper[66097:6741584]   Visible: YES
2025-11-06 16:00:28.006 test_wallpaper[66097:6741584]   Display ID: 1
2025-11-06 16:00:28.006 test_wallpaper[66097:6741584]   Display UUID: (skipping - will match by screen properties)
2025-11-06 16:00:30.008 test_wallpaper[66097:6741584]   Current wallpaper: /System/Library/CoreServices/DefaultDesktop.heic
2025-11-06 16:00:32.013 test_wallpaper[66097:6741584]   Current options: {
}
2025-11-06 16:00:32.013 test_wallpaper[66097:6741584]   Using options: {
    NSWorkspaceDesktopImageAllowClippingKey = 1;
    NSWorkspaceDesktopImageScalingKey = 3;
}
2025-11-06 16:00:34.020 test_wallpaper[66097:6741584]   ✓ API call SUCCESS (took 2.007 seconds)
2025-11-06 16:00:36.223 test_wallpaper[66097:6741584]   ⚠ Verification FAILED:
2025-11-06 16:00:36.223 test_wallpaper[66097:6741584]     Expected: /Users/blake/code/weatherdesktop/rendered/hud-251102-2153.jpg
2025-11-06 16:00:36.223 test_wallpaper[66097:6741584]     Actual:   /System/Library/CoreServices/DefaultDesktop.heic
2025-11-06 16:00:36.223 test_wallpaper[66097:6741584]     This indicates macOS extension system issue
2025-11-06 16:00:36.223 test_wallpaper[66097:6741584] -------------------------------------------
2025-11-06 16:00:36.223 test_wallpaper[66097:6741584] Screen 2:
2025-11-06 16:00:36.223 test_wallpaper[66097:6741584]   Frame: 3840 x 2160 @ -3840, -7
2025-11-06 16:00:36.223 test_wallpaper[66097:6741584]   Visible: YES
2025-11-06 16:00:36.223 test_wallpaper[66097:6741584]   Display ID: 6
2025-11-06 16:00:36.223 test_wallpaper[66097:6741584]   Display UUID: (skipping - will match by screen properties)
2025-11-06 16:00:38.228 test_wallpaper[66097:6741584]   Current wallpaper: /System/Library/CoreServices/DefaultDesktop.heic
2025-11-06 16:00:40.236 test_wallpaper[66097:6741584]   Current options: {
}
2025-11-06 16:00:40.236 test_wallpaper[66097:6741584]   Using options: {
    NSWorkspaceDesktopImageAllowClippingKey = 1;
    NSWorkspaceDesktopImageScalingKey = 3;
}
2025-11-06 16:00:42.242 test_wallpaper[66097:6741584]   ✓ API call SUCCESS (took 2.006 seconds)
2025-11-06 16:00:44.448 test_wallpaper[66097:6741584]   ⚠ Verification FAILED:
2025-11-06 16:00:44.448 test_wallpaper[66097:6741584]     Expected: /Users/blake/code/weatherdesktop/rendered/hud-251102-2153.jpg
2025-11-06 16:00:44.448 test_wallpaper[66097:6741584]     Actual:   /System/Library/CoreServices/DefaultDesktop.heic
2025-11-06 16:00:44.448 test_wallpaper[66097:6741584]     This indicates macOS extension system issue
2025-11-06 16:00:44.448 test_wallpaper[66097:6741584] ===========================================
2025-11-06 16:00:44.448 test_wallpaper[66097:6741584] Summary:
2025-11-06 16:00:44.448 test_wallpaper[66097:6741584]   Screens: 3
2025-11-06 16:00:44.448 test_wallpaper[66097:6741584]   API Success: 3
2025-11-06 16:00:44.448 test_wallpaper[66097:6741584]   API Failed: 0
2025-11-06 16:00:44.448 test_wallpaper[66097:6741584] ===========================================
2025-11-06 16:00:44.448 test_wallpaper[66097:6741584] Waiting 1 second for wallpaper extension system to process...
2025-11-06 16:00:45.450 test_wallpaper[66097:6741584] ===========================================
2025-11-06 16:00:45.450 test_wallpaper[66097:6741584] POST-SET VERIFICATION:
2025-11-06 16:00:47.458 test_wallpaper[66097:6741584] Screen 0 wallpaper URL: /System/Library/CoreServices/DefaultDesktop.heic
2025-11-06 16:00:47.459 test_wallpaper[66097:6741584]   ⚠ URL MISMATCH:
2025-11-06 16:00:47.459 test_wallpaper[66097:6741584]     Expected: /Users/blake/code/weatherdesktop/rendered/hud-251102-2153.jpg
2025-11-06 16:00:47.459 test_wallpaper[66097:6741584]     Actual:   /System/Library/CoreServices/DefaultDesktop.heic
2025-11-06 16:00:47.459 test_wallpaper[66097:6741584]     This indicates the API set a different wallpaper
2025-11-06 16:00:49.465 test_wallpaper[66097:6741584] Screen 1 wallpaper URL: /System/Library/CoreServices/DefaultDesktop.heic
2025-11-06 16:00:49.465 test_wallpaper[66097:6741584]   ⚠ URL MISMATCH:
2025-11-06 16:00:49.465 test_wallpaper[66097:6741584]     Expected: /Users/blake/code/weatherdesktop/rendered/hud-251102-2153.jpg
2025-11-06 16:00:49.465 test_wallpaper[66097:6741584]     Actual:   /System/Library/CoreServices/DefaultDesktop.heic
2025-11-06 16:00:49.465 test_wallpaper[66097:6741584]     This indicates the API set a different wallpaper
2025-11-06 16:00:51.466 test_wallpaper[66097:6741584] Screen 2 wallpaper URL: /System/Library/CoreServices/DefaultDesktop.heic
2025-11-06 16:00:51.466 test_wallpaper[66097:6741584]   ⚠ URL MISMATCH:
2025-11-06 16:00:51.466 test_wallpaper[66097:6741584]     Expected: /Users/blake/code/weatherdesktop/rendered/hud-251102-2153.jpg
2025-11-06 16:00:51.466 test_wallpaper[66097:6741584]     Actual:   /System/Library/CoreServices/DefaultDesktop.heic
2025-11-06 16:00:51.466 test_wallpaper[66097:6741584]     This indicates the API set a different wallpaper
2025-11-06 16:00:51.466 test_wallpaper[66097:6741584] ===========================================
2025-11-06 16:00:51.467 test_wallpaper[66097:6741584] ===========================================
2025-11-06 16:00:51.467 test_wallpaper[66097:6741584] WALLPAPER CONFIGURATION ANALYSIS:
2025-11-06 16:00:51.467 test_wallpaper[66097:6741584] Found wallpaper Index.plist at: /Users/blake/Library/Application Support/com.apple.wallpaper/Store/Index.plist
2025-11-06 16:00:51.476 test_wallpaper[66097:6741584] Found 8 display configurations
2025-11-06 16:00:51.476 test_wallpaper[66097:6741584]   Display UUID: 3338FFE0-D783-400C-9CED-C310820AE4B0
2025-11-06 16:00:51.476 test_wallpaper[66097:6741584]     Provider: com.apple.wallpaper.choice.image
2025-11-06 16:00:51.476 test_wallpaper[66097:6741584]     Configured wallpaper: file:///Users/blake/code/weatherdesktop/rendered/hud-251106-1537.jpg
2025-11-06 16:00:51.476 test_wallpaper[66097:6741584]   Display UUID: AA26E938-41D2-4DD1-B5CF-093B8B09BB14
2025-11-06 16:00:51.476 test_wallpaper[66097:6741584]     Provider: com.apple.wallpaper.choice.image
2025-11-06 16:00:51.476 test_wallpaper[66097:6741584]     Configured wallpaper: file:///Users/blake/code/weatherdesktop/rendered/hud-231022-1750.jpg
2025-11-06 16:00:51.476 test_wallpaper[66097:6741584]   Display UUID: 45CBB89F-A096-496F-BD2C-E2A665FFC16B
2025-11-06 16:00:51.476 test_wallpaper[66097:6741584]     Provider: com.apple.wallpaper.choice.image
2025-11-06 16:00:51.476 test_wallpaper[66097:6741584]     Configured wallpaper: file:///Users/blake/Library/Containers/com.apple.wallpaper.agent/Data/Library/Caches/com.apple.wallpaper.caches/extension-com.apple.wallpaper.extension.image/hud-251102-2153.jpg.jpg
2025-11-06 16:00:51.476 test_wallpaper[66097:6741584]   Display UUID: 181FD805-2525-4530-99C9-94B23CB8D552
2025-11-06 16:00:51.476 test_wallpaper[66097:6741584]     Provider: com.apple.wallpaper.choice.image
2025-11-06 16:00:51.476 test_wallpaper[66097:6741584]     Configured wallpaper: file:///Users/blake/code/weatherdesktop/rendered/hud-241013-2145.jpg
2025-11-06 16:00:51.476 test_wallpaper[66097:6741584]   Display UUID: 39D98815-89B4-4089-8BE1-0A5D1522CCCE
2025-11-06 16:00:51.476 test_wallpaper[66097:6741584]     Provider: com.apple.wallpaper.choice.image
2025-11-06 16:00:51.476 test_wallpaper[66097:6741584]     Configured wallpaper: file:///Users/blake/code/weatherdesktop/rendered/hud-251031-1110.jpg
2025-11-06 16:00:51.476 test_wallpaper[66097:6741584]   Display UUID: 55D48952-C3BA-4B6D-A2CB-0D9A903913F8
2025-11-06 16:00:51.476 test_wallpaper[66097:6741584]     Provider: com.apple.wallpaper.choice.image
2025-11-06 16:00:51.476 test_wallpaper[66097:6741584]     Configured wallpaper: file:///Users/blake/code/weatherdesktop/rendered/hud-251106-1540.jpg
2025-11-06 16:00:51.476 test_wallpaper[66097:6741584]   Display UUID: 99040000-6CD6-4722-902B-FA419DE35207
2025-11-06 16:00:51.476 test_wallpaper[66097:6741584]     Provider: com.apple.wallpaper.choice.image
2025-11-06 16:00:51.476 test_wallpaper[66097:6741584]     Configured wallpaper: file:///Users/blake/code/weatherdesktop/rendered/hud-231220-1915.jpg
2025-11-06 16:00:51.476 test_wallpaper[66097:6741584]   Display UUID: E69B103F-D0EF-4749-8104-F6BC0E64066B
2025-11-06 16:00:51.476 test_wallpaper[66097:6741584]     Provider: com.apple.wallpaper.choice.image
2025-11-06 16:00:51.476 test_wallpaper[66097:6741584]     Configured wallpaper: file:///Users/blake/Library/Containers/io.dotfirst.DownlinkMac/Data/Documents/assets/desktops/MDAwMDM4NDAwMjE2MDAgbm9ydGhlcm4tcGFjaWZpYy1nb2VzLXdlc3QgMTY0OTgwNzE3MS4w.jpg
2025-11-06 16:00:51.476 test_wallpaper[66097:6741584] ===========================================
2025-11-06 16:00:51.476 test_wallpaper[66097:6741584] API SUCCESS: setDesktopImageURL returned YES for all 3 screens
2025-11-06 16:00:51.476 test_wallpaper[66097:6741584] NOTE: If wallpaper doesn't visually change, this is a macOS Sequoia extension system issue
2025/11/06 16:00:51 ===========================================
2025/11/06 16:00:51 RESULT: API call reported SUCCESS
2025/11/06 16:00:51 ===========================================
2025/11/06 16:00:51 IMPORTANT: Keeping process alive for wallpaper extension system
2025/11/06 16:00:51 Based on testing, WallpaperAgent takes ~32-45 seconds to process
2025/11/06 16:00:51 ===========================================
2025/11/06 16:00:51 Waiting 5 seconds...
2025/11/06 16:00:56 --- Check at 5 seconds ---
2025/11/06 16:00:58 Screen 0 wallpaper: 
2025/11/06 16:00:58 ⚠ Showing different wallpaper: 
2025/11/06 16:00:58 Waiting 5 more seconds (total: 10)...
2025/11/06 16:01:03 --- Check at 10 seconds ---
2025/11/06 16:01:05 Screen 0 wallpaper: 
2025/11/06 16:01:05 ⚠ Showing different wallpaper: 
2025/11/06 16:01:05 Waiting 5 more seconds (total: 15)...
2025/11/06 16:01:10 --- Check at 15 seconds ---
2025/11/06 16:01:12 Screen 0 wallpaper: 
2025/11/06 16:01:12 ⚠ Showing different wallpaper: 
2025/11/06 16:01:12 Waiting 5 more seconds (total: 20)...
2025/11/06 16:01:17 --- Check at 20 seconds ---
2025/11/06 16:01:19 Screen 0 wallpaper: 
2025/11/06 16:01:19 ⚠ Showing different wallpaper: 
2025/11/06 16:01:19 Waiting 5 more seconds (total: 25)...
2025/11/06 16:01:24 --- Check at 25 seconds ---
2025/11/06 16:01:26 Screen 0 wallpaper: 
2025/11/06 16:01:26 ⚠ Showing different wallpaper: 
2025/11/06 16:01:26 Waiting 5 more seconds (total: 30)...
2025/11/06 16:01:31 --- Check at 30 seconds ---
2025/11/06 16:01:33 Screen 0 wallpaper: 
2025/11/06 16:01:33 ⚠ Showing different wallpaper: 
2025/11/06 16:01:33 Waiting 5 more seconds (total: 35)...
2025/11/06 16:01:38 --- Check at 35 seconds ---
2025/11/06 16:01:40 Screen 0 wallpaper: 
2025/11/06 16:01:40 ⚠ Showing different wallpaper: 
2025/11/06 16:01:40 Waiting 5 more seconds (total: 40)...
2025/11/06 16:01:45 --- Check at 40 seconds ---
2025/11/06 16:01:47 Screen 0 wallpaper: 
2025/11/06 16:01:47 ⚠ Showing different wallpaper: 
2025/11/06 16:01:47 Waiting 5 more seconds (total: 45)...
2025/11/06 16:01:52 --- Check at 45 seconds ---
2025/11/06 16:01:54 Screen 0 wallpaper: 
2025/11/06 16:01:54 ⚠ Showing different wallpaper: 
2025/11/06 16:01:54 ===========================================
2025/11/06 16:01:54 FINAL VERIFICATION:
2025/11/06 16:01:56 Screen 0 wallpaper: 
2025/11/06 16:01:56 ? UNEXPECTED: Showing different wallpaper than expected
2025/11/06 16:01:56 ===========================================
2025/11/06 16:01:56 DIAGNOSIS:
2025/11/06 16:01:56 Check Console.app logs for detailed error information:
2025/11/06 16:01:56   log show --predicate 'subsystem == "com.apple.wallpaper"' --last 1m
2025/11/06 16:01:56 Look for:
2025/11/06 16:01:56   - WallpaperExtensionKit.WallpaperExtensionError
2025/11/06 16:01:56   - NSCocoaErrorDomain (4099)
2025/11/06 16:01:56   - 'Failed to create snapshot to export'
2025/11/06 16:01:56   - XPC connection errors
